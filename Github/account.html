{% extends "base.html" %}

{% block title %}Account Dashboard - Cash IT{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="glass-card p-4">
                <h1><i class="fas fa-chart-line"></i> Welcome back, {{ user.name }}!</h1>
                <p class="text-muted">Here's your financial overview for today</p>
            </div>
        </div>
    </div>

    <!-- Account Balance Cards -->
    <div class="row mb-4">
        {% for account_type, account_data in user.accounts.items() %}
        <div class="col-lg-4 col-md-6 mb-3">
            <div class="account-card {{ account_type }}">
                <div class="account-header">
                    <h5>
                        <i class="fas fa-{{ 'university' if account_type == 'checking' else 'piggy-bank' if account_type == 'savings' else 'credit-card' }}"></i>
                        {{ account_type.title() }} Account
                    </h5>
                    <span class="account-number">****{{ account_data.account_number[-4:] }}</span>
                </div>
                <div class="balance-display">
                    <span class="balance-amount {{ 'negative' if account_data.balance < 0 else '' }}">
                        ${{ "{:,.2f}".format(account_data.balance) }}
                    </span>
                    {% if account_type == 'credit' and 'credit_limit' in account_data %}
                    <div class="credit-limit">
                        Credit Limit: ${{ "{:,.2f}".format(account_data.credit_limit) }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="glass-card p-4">
                <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
                <div class="row g-3 mt-2">
                    <div class="col-lg-2 col-md-4 col-6">
                        <a href="{{ url_for('transactions') }}" class="quick-action-btn">
                            <i class="fas fa-plus"></i>
                            <span>Add Transaction</span>
                        </a>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6">
                        <a href="{{ url_for('budget') }}" class="quick-action-btn">
                            <i class="fas fa-calculator"></i>
                            <span>Create Budget</span>
                        </a>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6">
                        <a href="{{ url_for('savings') }}" class="quick-action-btn">
                            <i class="fas fa-piggy-bank"></i>
                            <span>Savings Goal</span>
                        </a>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6">
                        <a href="{{ url_for('investments') }}" class="quick-action-btn">
                            <i class="fas fa-chart-pie"></i>
                            <span>Invest</span>
                        </a>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6">
                        <a href="{{ url_for('bills') }}" class="quick-action-btn">
                            <i class="fas fa-file-invoice"></i>
                            <span>Pay Bills</span>
                        </a>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6">
                        <a href="{{ url_for('analytics') }}" class="quick-action-btn">
                            <i class="fas fa-chart-bar"></i>
                            <span>Analytics</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Recent Transactions -->
        <div class="col-lg-8 mb-4">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="fas fa-history"></i> Recent Transactions</h4>
                    <a href="{{ url_for('transactions') }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-external-link-alt"></i> View All
                    </a>
                </div>
                
                {% if recent_transactions %}
                <div class="transaction-list">
                    {% for transaction in recent_transactions %}
                    <div class="transaction-item">
                        <div class="transaction-icon {{ transaction.type }}">
                            <i class="fas fa-{{ 'arrow-up' if transaction.type == 'credit' else 'arrow-down' }}"></i>
                        </div>
                        <div class="transaction-details">
                            <div class="transaction-description">{{ transaction.description }}</div>
                            <div class="transaction-meta">
                                {{ transaction.date }} • {{ transaction.category }} • {{ transaction.account_type.title() }}
                            </div>
                        </div>
                        <div class="transaction-amount {{ transaction.type }}">
                            {{ '+' if transaction.type == 'credit' else '-' }}${{ "{:,.2f}".format(transaction.amount) }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>No recent transactions</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar Widgets -->
        <div class="col-lg-4">
            <!-- Budget Summary -->
            {% if budget_summary and budget_summary.total_budget > 0 %}
            <div class="glass-card p-4 mb-4">
                <h5><i class="fas fa-calculator"></i> This Month's Budget</h5>
                <div class="budget-progress">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Spent: ${{ "{:,.2f}".format(budget_summary.total_spent) }}</span>
                        <span>Budget: ${{ "{:,.2f}".format(budget_summary.total_budget) }}</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" 
                             style="width: {{ (budget_summary.total_spent / budget_summary.total_budget * 100) if budget_summary.total_budget > 0 else 0 }}%">
                        </div>
                    </div>
                    <div class="text-center mt-2">
                        <span class="remaining-budget">
                            ${{ "{:,.2f}".format(budget_summary.total_budget - budget_summary.total_spent) }} remaining
                        </span>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Savings Goals -->
            {% if savings_goals %}
            <div class="glass-card p-4 mb-4">
                <h5><i class="fas fa-piggy-bank"></i> Savings Goals</h5>
                {% for goal in savings_goals[:2] %}
                <div class="savings-goal mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span class="goal-name">{{ goal.name }}</span>
                        <span class="goal-progress">{{ "{:.1f}".format((goal.current_amount / goal.target_amount * 100) if goal.target_amount > 0 else 0) }}%</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: {{ (goal.current_amount / goal.target_amount * 100) if goal.target_amount > 0 else 0 }}%">
                        </div>
                    </div>
                    <div class="goal-amounts">
                        <small>${{ "{:,.2f}".format(goal.current_amount) }} of ${{ "{:,.2f}".format(goal.target_amount) }}</small>
                    </div>
                </div>
                {% endfor %}
                <a href="{{ url_for('savings') }}" class="btn btn-outline-success btn-sm w-100">
                    <i class="fas fa-external-link-alt"></i> View All Goals
                </a>
            </div>
            {% endif %}

            <!-- Financial Health Score -->
            <div class="glass-card p-4">
                <h5><i class="fas fa-heartbeat"></i> Financial Health</h5>
                <div class="health-score">
                    <div class="score-circle">
                        <span class="score-number">85</span>
                        <span class="score-label">Good</span>
                    </div>
                    <div class="health-tips">
                        <p><i class="fas fa-check-circle text-success"></i> Emergency fund is growing</p>
                        <p><i class="fas fa-exclamation-circle text-warning"></i> Consider increasing savings rate</p>
                    </div>
                </div>
                <a href="{{ url_for('analytics') }}" class="btn btn-outline-info btn-sm w-100">
                    <i class="fas fa-chart-bar"></i> View Detailed Analysis
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh account balances every 30 seconds
setInterval(function() {
    // In a real application, you might update balances via AJAX
    console.log('Checking for balance updates...');
}, 30000);

// Add click animations to quick action buttons
document.querySelectorAll('.quick-action-btn').forEach(button => {
    button.addEventListener('click', function(e) {
        this.style.transform = 'scale(0.95)';
        setTimeout(() => {
            this.style.transform = 'scale(1)';
        }, 150);
    });
});
</script>
{% endblock %}
